{
  "id": 111,
  "title": "migrate_parent_id",
  "body": "#!/usr/bin/env python3\nimport sqlite3\nimport os\n\nDB_PATH = \"./storage/documents.db\"\n\ndef column_exists(cursor, table, column):\n    cursor.execute(f\"PRAGMA table_info({table});\")\n    cols = [row[1] for row in cursor.fetchall()]\n    return column in cols\n\ndef migrate():\n    if not os.path.exists(DB_PATH):\n        print(f\"\u274c Database not found at {DB_PATH}\")\n        return\n\n    conn = sqlite3.connect(DB_PATH)\n    cur = conn.cursor()\n\n    # Check if parent_id column exists\n    if not column_exists(cur, \"documents\", \"parent_id\"):\n        print(\"\ud83d\udd27 Adding parent_id column to documents table...\")\n        cur.execute(\"ALTER TABLE documents ADD COLUMN parent_id INTEGER;\")\n        conn.commit()\n        print(\"\u2705 Column added.\")\n    else:\n        print(\"\u2139\ufe0f parent_id column already exists. No changes made.\")\n\n    # Show schema after migration\n    print(\"\\n\ud83d\udcdc Updated table schema:\")\n    cur.execute(\"PRAGMA table_info(documents);\")\n    for row in cur.fetchall():\n        print(row)\n\n    conn.close()\n\nif __name__ == \"__main__\":\n    migrate()\n\n"
}