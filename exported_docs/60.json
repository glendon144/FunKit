{
  "id": 60,
  "title": "commit_and_push_opml",
  "body": "#!/usr/bin/env bash\n# commit_and_push_opml.sh\n# Create/update CHANGELOG.md with milestone notes, commit, tag, and push.\n\nset -euo pipefail\n\nMILESTONE_NOTES=$(cat <<'EOF'\n## \u2728 OPML Rendering & TreeView lineage milestone \u2014 2025-08-07\n\n- Automatic OPML detection and rendering in the document pane.\n- Integrated OPML parsing directly into _render_document (BOM-safe).\n- Fixed geometry manager conflict (grid vs pack) in OPML view.\n- Restored toolbar handlers (e.g., _on_delete_clicked, _handle_image).\n- TreeView lineage displays correctly from green links.\n- OPML tree depth preference persists until changed by user.\n\nTagging this as the first stable OPML-capable build of FunKit.\nEOF\n)\n\n# Ensure we are in repo\ngit rev-parse --is-inside-work-tree >/dev/null 2>&1 || {\n    echo \"\u274c Not in a git repository.\"\n    exit 1\n}\n\n# Create or prepend to CHANGELOG.md\nif [[ -f CHANGELOG.md ]]; then\n    echo -e \"$MILESTONE_NOTES\\n\\n$(cat CHANGELOG.md)\" > CHANGELOG.md\nelse\n    echo -e \"$MILESTONE_NOTES\\n\" > CHANGELOG.md\nfi\n\n# Stage everything\ngit add -A\n\n# Bail if nothing staged\nif git diff --cached --quiet; then\n    echo \"\u2139\ufe0f No changes to commit.\"\n    exit 0\nfi\n\n# Commit\nNOW=\"$(date -Iseconds)\"\ngit commit -m \"\u2728 OPML Rendering & TreeView lineage milestone\" -m \"$NOW\"\n\n# Create unique tag\nTAG_BASE=\"opml_baseline_$(date +%Y%m%d_%H%M)\"\nTAG=\"$TAG_BASE\"\ni=2\nwhile git rev-parse -q --verify \"refs/tags/$TAG\" >/dev/null; do\n    TAG=\"${TAG_BASE}_$i\"\n    i=$((i+1))\ndone\ngit tag -a \"$TAG\" -m \"Snapshot: $TAG\"\n\n# Push branch + tag\nBRANCH=$(git rev-parse --abbrev-ref HEAD)\nif git remote get-url origin >/dev/null 2>&1; then\n    if git rev-parse --abbrev-ref --symbolic-full-name @{u} >/dev/null 2>&1; then\n        git push\n    else\n        git push --set-upstream origin \"$BRANCH\"\n    fi\n    git push origin \"$TAG\"\n    echo \"\u2705 Pushed branch '$BRANCH' and tag '$TAG'.\"\nelse\n    echo \"\u26a0\ufe0f No remote 'origin' configured. Commit and tag are local.\"\nfi\n\n"
}